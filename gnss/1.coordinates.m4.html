include(sourceRoot/definitions.m4)
define(pageTitle, `coordinates')
include(sourceRoot/leader.m4.html)

linksList(`1.coordinates.html', `index.html', `2.position.html')

<h2>Geographical Coordinate Systems</h2>
<p>
    GNSS systems report positions using all sorts of conventions
    so we have to look at the different ways that a position
    can be represented.
</p>
<p>
    This guide from the UK's mapping authority
    The Ordnance Survey gives an excellent introduction.
    What follows is my take on the subject.
</p>
<h3>The Shape of the Earth</h3>
<p>
    According to
    <a
        href="https://en.wikipedia.org/wiki/Giant-impact_hypothesis#:~:text=Astronomers%20think%20the%20collision%20between,Earth%20was%20nearly%20fully%20formed">
        current theories
    </a>
    the Earth was formed about 4.5 billion years ago
    when two planets collided.
    The heat generated by the impact
    caused the two bodies to melt
    and then merge.
    Some of the material was ejected and coalesced to form the Moon.
</p>
<p>
    The resulting Earth has a solid core at the centre,
    very hot but under huge pressure,
    which stops it from melting.
    Further out from the centre
    the temperature and pressure are a little lower
    and the material flows like a viscous liquid.
    The surface crust is cool enough to be solid
    and floats on the underlying
    fluid layer.
</p>
<p>
    Denser crust material sinks deeper into the fluid
    and forms the ocean bed.
    Lighter material floats a little higher and forms the land.
    The crust is broken into large plates
    which move around slowly,
    pulled by convection currents in the underlying fluid.
</p>
<p>
    The material in one of the original two planets was
    denser than in the other and there are still huge lumps
    of denser material slowly moving around deep under the surface.
    On the surface,
    the tides move huge volumes of water
    backwards and forwards during the day.
    Even a nearby mountain can have enough material
    in it to deflect local gravity slightly.
    These and other factors
    cause local gravity to be uneven
    so that it doesn't always pull directly towards the centre of mass.
</p>
<p>
    The result of all this is this is that nothing
    on the Earth is fixed.
    There's no solid ground.
    We have a thin shell,
    relatively solid,
    around a huge boiling maelstrom of fluid.
    Convection current deep inside stir up the material,
    causing the continents on the surface to move around and
    change shape very slowly.

</p>
<p>
    The Earth is held together by its own gravity and is almost,
    but not quite, a sphere.
    It spins on an axis,
    which stretches it very slightly at the Equator and
    shrinks it very slightly at the poles,
    making it more like an ellipsoid.
</p>
<p>
    Geographers have defined a perfect ellipsoid
    that's close on average to the Earth's real shape.
    It's called "the Ellipsoid" (capital E).
</p>
<p>
<h3>Latitude and Longitude</h3>
<p>
    Geographers divide up the Ellipsoid using the familiar
    imaginary lines of longitude and latitude.
    A position on the surface of the Ellipsoid
    can be specified in degrees, minutes and seconds
    of longitude and latitude.
    A minute is one sixtieth of a degree of arc
    and a second is one sixtieth of a minute.
</p>
<p>
    The lines of
    <a href='https://oceanservice.noaa.gov/facts/longitude.html'>longitude</a>
    (or "meridians")
    are ellipses running north-south from pole to pole around
    the axis of rotation of the Ellipsoid.
    They mark positions east to west.
    The Prime Meridian runs through
    the grounds of Greenwich Observatory in London.
    It has a longitude of zero degrees.
</p>
<p>
    The lines of
    <a
        href="file:///home/simon/projects/website.accurateposition.org/gnss/'https://oceanservice.noaa.gov/facts/latitude.html'">latitude</a>
    (or "parallels") are circles
    (not ellipses)
    running east-west
    around the Ellipsoid.
    They mark positions north to south.
    The equator is the parallel
    on which every point is equidistant
    from the two poles.
    That's zero latitude.
</p>
<p>
    <a
        href="https://www.open.edu/openlearn/society/politics-policy-people/geography/diy-measuring-latitude-and-longitude#:~:text=The%20Earth%20rotates%20one%20full,noon%20at%20the%20Prime%20Meridian.">
        This page
    </a>
    from the UK Open University explains
    how to use some very simple equipment
    to find your longitude and latitude
    relative to the Greenwich Meridian
    and the Equator.
</p>
<p>
    The more accurate your measuring equipment
    and clock,
    the more accurate will be your result.
</p>


<p>
    The poles and the equator,
    and therefore the positions of the lines of latitude,
    are real objects, arising from the Earth's rotation.
    In contrast,
    the position of the prime meridian is entirely arbitrary.
    It's wherever people agree it should be.
    The Greenwich Observatory was set up by the
    British Admiralty who ran what was at the time the
    world's most powerful navy.
    They decided where the prime meridian would lie and
    everybody else accepted it.
</p>

<p>
    In fact, the Greenwich Observatory
    has moved the prime meridian around its grounds
    several times
    over the years and
    in any case it moves all the time due to continental drift.
</p>
<p>
    That didn't used to matter because the technology to
    find your position was not accurate enough to notice
    but now that we have GNSS receivers accurate to
    two or three centimetres,
    it does matter.
    As we will see,
    it's also become convenient to
    define several versions of latitude and longitude,
    each with meridians in different places.
</p>
<p>
    The French had
    their own favourite meridian,
    which ran through the Paris Observatory.
    If France had won the Napoleonic Wars,
    that may well have been the agreed
    prime meridian.
    When the French government
    first defined
    the <a href='https://en.wikipedia.org/wiki/Metre'>metre</a>
    they said it was one ten millionth of the distance
    from the Equator to the North Pole
    along their meridian.
    Unfortunately that made the size of it
    subject to continental drift.
    The definition has been refined twice since then
    using more stable metrics.
</p>
<h3>Longitude, Latitude and Distance</h3>
<p>
    If my GNSS equipment gives me the longitude and latitude
    of two positions on the surface of the Ellipsoid,
    how far apart are they?
</p>
<p>
    It's convenient to pretend that the earth is a sphere,
    which it almost is,
    so all the meridians are the same length.
    It has radius 6,371,000 metres, diameter 12,714,000 metres.
    The circumference of a circle is diameter X PI, so
    the circumference of the Equator is about 40,000,000 metres.
</p>
<p>
    There are 360 degree or 1,296,000 seconds in a circle
    so one degree of longitude covers about 111,111 metres
    around a meridian,
    one minute of latitude covers about 1,851 metres and
    one second of latitude covers about 31 metres.
    0.001 seconds of latitude covers about
    three centimetres north to south around a meridian.
</p>
<p>
    Having worked that out,
    for positions close to each other
    it becomes convenient to pretend that the Earth is flat,
    and not worry about the curvature.
</p>
<p>
    If your GNSS receiver is accurate to about three centimetres
    and it displays your position as degrees, minutes and seconds
    of latitude and longitude,
    this means that you can ignore all but the first three
    decimal places of the seconds part of
    the latitude result.
</p>
<p>
    Longitude is a little bit harder,
    because the parallel circles are different sizes.
</p>
<p>
    I live in the UK which lies between
    the 50 degree parallel and the 60 degree parallel.
    The city of Newcastle-upon-Tyne is close to the middle at
    54.9783 degrees latitude.
    Let's say 55 degrees:
</p>
<img srcset='/images/longitudinal.distance/longitudinal.distance.100.jpg 100w,
    /images/longitudinal.distance/longitudinal.distance.200.jpg 200w,
    https://accurateposition.org/images/longitudinal.distance/longitudinal.distance.400.jpg 400w' sizes=' (max-width: 160px) 100px, (max-width: 360px) 200px, (max-width: 400px)
    513px, 513px' alt='a circle with a radius drawn at an angle of 55 degrees'>
<p>
    The earth has radius 6,371,000 metres,
    which is the length of the hypotenuse of the right-angled triangle in the picture.
    The sine of an angle is (length of opposite side) divided by (length of hypotenuse),
    so given the angle 35 degrees
    we can work out r, the radius of the 55 degree parallel.
    I get 3654255 metres.
</p>
<p></p>
The circumference of a circle of radius r is
</p>
<p>
    2 X pi X r
</p>
<p>
    A spreadsheet will work the whole thing out for you.
    Microsoft Excel's sine function works in radians,
    not degrees.
    To convert the angle to radians,
    multiply by PI/180.
</p>
<p>
    If my mathematical working is correct,
    you can use this Excel formula to calculate the
    circumference of the 55 degree parallel:
</p>
<p>
    =(SIN(35*PI()/180)*6371000*2*PI())
</p>
<p>
    which gives 22,960,364 metres,
    very roughly half the circumference of one of the meridians.
</p>
<p>
    Dividing that by 360 X 3600
    gives the distance covered by one second of longitude at
    latitude 55 degrees - about 18 metres,
    so 0.001 seconds covers about 1.8 centimetres east to west,
    which is below the resolution of my equipment
    but close to it.
</p>
<p>
    If I'm working in the UK
    and my GNSS equipment is displaying my latitude in seconds,
    I should ignore
    all but the first three decimal places and be a bit suspicious
    of the third decimal place.
</p>

<p>
    In a test
    with my Trimble Catalyst GNSS receiver
    fixed in one place
    the seconds value for the latitude
    varied from 11.6873 to 11.6875,
    and the one for longitude varied
    from 9.7803 to 9.7808.
    In terms of distance those values range over
    9 millimetres,
    and 15 millimetres,
    respectively.
    In the same test,
    the orthonometric height
    varied from 201.77 metres
    to 201.78 metres above the Geoid,
    so it ranged over one centimetre.
</p>

<h3>Vertical and Horizontal</h3>
<p>
    As we will see,
    some concepts that we think
    are very simple and obvious
    turn out out to be a little more complicated.
    The concept of something being
    "vertically above" something else,
    is an example.
    In the Eighteenth Century,
    Nevil Maskelyne,
    the UK's Astronomer Royal,
    showed that a plumb line
    close to an isolated mountain
    will deviate slightly from the vertical
    due to the gravitational pull of the nearby huge mass of rock.
</p>
<p>
    This was a nuisance to astronomers because
    they used plumb lines and baths of mercury
    to align their telescopes,
    assuming that the plumb line would be vertical
    and the surface if the mercury would be horizontal.
    They could work out the position of their telescope
    by taking sighting of celestial objects,
    but a deviation in local gravity of just a few seconds
    would produce the wrong result.
</p>
<p>
    Sure enough, this is exactly what happened in 1830
    when a team led by Astronomer Royal
    George Airy at the Greenwich Observatory measured the position
    of the prime meridian and put a
    mark on the ground
    showing where they thought it was.
    The mark was about 100 metres from the correct position.
    Read about that
    <a href="https://www.timeanddate.com/geography/prime-meridian-wrong.html">
        here
    </a>
    .
</p>
<p>
    Since the line was fixed
    the ground beneath it has moved
    again by about a few more metres
    due to continental drift.
</p>
<p>
    If your plumb line doesn't show you the vertical,
    then what does?
    This was one reason for the invention of the Geoid,
    described below.
</p>

<p>
    Page 16 of
    <a href="https://www.ordnancesurvey.co.uk/documents/resources/guide-coordinate-systems-great-britain.pdf/">
        the OS Guide
    </a>
    discusses this issue.
    That guide also explains why
    national mapmakers define other ellipsoids
    that approximate better
    to their local landscape.
</p>

<h3>The Geoid</h3>
<p>
    As already mentioned,
    gravity doesn't point in the same direction everywhere,
    There's another solid shape called <b><i>The Geoid</i></b>
    (which just means "Earth-shaped" in Latin).
    According to Wikipedia:
    "The
    Geoid is the shape that the ocean surface
    would take under the influence of the gravity of Earth, including
    gravitational attraction and Earth's rotation,
    if other influences such as winds and tides were absent.
    This surface
    is extended through the continents."
</p>
<p>
    You can find more about The Geoid
    <a href="https://www.usgs.gov/faqs/what-geoid-why-do-we-use-it-and-where-does-its-shape-come">
        here
    </a>.

</p>
<p>
    As with ellipsoids,
    mapmakers define their own geoids
    which more closely match their local conditions.
</p>
<p>
    To sum up, the Ellipsoid is a <i>regular</i> solid that approximates to the shape of the Earth
    and the Geoid is an <i>irregular</i> solid that also approximates to the shape of the Earth.
    Local ellipsoids and geoids can
    approximate the local landscape more closely
    than one designed to work globally.
</p>
<h3>The Poles</h3>
<p>
    The Earth's axis of spin runs through the
    centre of mass.
    We call the points where this axis
    meets the Ellipsoid
    the North and South Poles.
    The position of those objects was measured
    with increasing accuracy from the early
    twentieth century onwards.
    In 1984 the Bureau International d'Heure
    produced what became the
    <a href="https://mycoordinates.org/the-real-definition-of-itrf/">
        International Terrestrial Reference Frame
    </a>,
    which defines everything needed to specify
    a position on the Earth -
    the Poles, the Ellipsoid,
    the Equator etc.
    Because of continental drift
    this is a moving target
    and the International Earth Rotation Service (IERS)
    updates the definition every few years
    to keep it in line with reality.

</p>


<h3>Height</h3>
<p>
    Your angle of longitude,
    angle of latitude
    and height
    identify your position anywhere on the Earth.
</p>

<p>
    Height looks like a simple concept,
    but height above what?
</p>
<p>
    Your <b><i>Ellipsoidal Height</i></b> is
    your height above or below the Ellipsoid
    along a line perpendicular to its surface.
<p>
    Similarly, your <b><i>geoidal height</i></b>
    or <b><i>orthometric height</i></b> is
    your height above or below the Geoid.
</p>
<p>
    You can also represent your height
    as your height above local mean sea level.
</p>

<p>
    In the 1920's the UK Ordnance Survey
    established a measuring station at Newlyn in Cornwall.
    Essentially it's vertical tube,
    partly immersed in the sea,
    with a float sitting on the surface of the water.
    Engineers took regular readings of the
    position of the float to establish mean sea level.
    UK maps show the height of a position as an offset
    from this datum.
</p>

<p>
    Here in the UK there's a phenomenon called
    <a
        href="https://en.wikipedia.org/wiki/Post-glacial_rebound#:~:text=In%20Great%20Britain%2C%20glaciation%20affected,to%205%20cm%20per%20century).">
        The Post-Glacial Rebound
    </a>.
    During the last ice age,
    ice a few kilometres thick
    covered Scotland, Wales and most of England,
    but it stopped short of the south coast.
    The weight of the ice pushed Scotland downwards
    and in response the southern end of England rose upwards.
    Since the ice melted
    the land has been bouncing back,
    which causes Scotland to rise from the sea by a couple of millimetres
    each year
    and
    the south of England to sink in response.
    This increases the effect of
    sea level rise in the south of England
    and decreases it in the North of Scotland.
</p>
<p>
    Further north the ice was even thicker
    and the land pushed down even further.
    Parts of northern Europe are rising
    at one centimetre per year.
</p>
<p>
    Meanwhile, sea levels are rising
    across the world due to global warming.
    The effect is bigger in the UK than
    the post-glacial rebound,
    so the overall effect is that that
    sea levels are rising everywhere in the UK,
    but they are rising a bit faster
    in the south than in the north.
</p>
<p>
    So UK Mean Sea Level was defined a century ago and
    sea levels have risen steadily since then.
    Strictly, this doesn't matter,
    because UK mean sea level was always just an arbitrary value -
    the mean level of the sea in other places around
    the coast of the UK can be different anyway
    due to local currents and other factors.
</p>
<p>
    Page 16 of
    <a href="https://www.ordnancesurvey.co.uk/documents/resources/guide-coordinate-systems-great-britain.pdf/">
        the OS Guide</a>
    discusses this issue.
</p>

<p>
    Different GNSS devices display your height
    using one of ellipsoidal height,
    geoidal height or height above mean sea level.
    Geoidal height and height above mean sea level
    are usually similar but not the same.
    Ellipsoidal height can be very different
    from the other two
    measures at the same position.
</p>



<h3>What time is it?</h3>
<p>
    Our notion of time is based on the
    Prime Meridian.
    People follow different timezones around the world
    but they are all based on
    Coordinated Universal Time (UTC).
    In winter in the UK we use
    the Greenwich Mean Time (GMT) timezone,
    which follows UTC - midnight GMT is midnight UTC.
    In France they use
    Central European Time (CET) which is one hour ahead -
    midnight CET is 1am UTC.
</p>
<p>
    As explained
    <a href="https://en.wikipedia.org/wiki/Greenwich_Mean_Time">here</a>,
    the sun is at its highest point above
    the Prime Meridian at
    different times of day over the year,
    varying over about 16 minutes.
    Noon UTC
    is set to the mean of those times,
    so everybody's notion of
    the time of day depends upon
    the precise position of the Prime Meridian,
    which is now based on the work of IERS.
</p>


<h3>The Rate of Continental Drift</h3>

<p>
    The Earth's surface is divided into <b><i>plates</i></b>
    which move around the surface slowly
    due to
    <a href="https://education.nationalgeographic.org/resource/continental-drift/">
        continental drift
    </a>.
    The part of the European plate
    that I live on moves against
    longitude and latitude
    at about 2.5 cm per year
    going approximately north-east.
    Meanwhile the USA and Europe are moving apart at about 3cm per year.
</p>
<p>
    This didn't matter so much
    before accurate GNSS equipment came along,
    but now the movement can be detected
    using equipment costing only a few hundred dollars.
</p>

<h3>Terrestrial Reference Frames</h3>
<p>
    A network of observatories
    ("ground stations")
    around the world
    constantly measure the distance
    to each GNSS satellite very accurately.
    The results drive the calculations
    for Precise Point Positioning,
    which is used to correct
    the results of a GNSS survey.
</p>
<p>
    A side effect is that the positions of
    the ground stations are known very accurately.
    These positions are published,
    along with the velocity of the station
    (in other words, the velocity
    of the ground beneath it)
    in metres per year.
</p>
<p>
    Since everything on the Earth's surface
    is moving
    and a position only makes sense
    relative to another position,
    what does it mean to "fix" the Equator
    and Prime Meridian?
</p>
<p>
    One way is to fix them
    at the mean of the movement
    of all of the continental plates.
    That's the basis of the
    International Terrestrial Reference Frame (ITRF).
</p>
<p>
    If you work within this reference frame
    and
    measure the longitude and latitude of a "fixed" object
    on the ground today,
    then come back and do it again in a few years time,
    you will
    get a different answer.
    That line on the ground at
    the Greenwich Observatory
    moves north-east relative to the ITRF
    at about 2.5 centimetres per year.

</p>
<p>
    For the purposes of land surveying,
    this is very inconvenient
    because any position measurements
    that you take gradually become
    out of date.
    If a utility company buries a pipe in the ground
    and wants to come back twenty years later
    to do some maintenance,
    finding where to dig quickly and accurately
    saves money.
    Having to correct the position measurement
    for the passage of time is a nuisance.
</p>
<p>

    Another way to represent your position
    is to fix a notional Equator and Prime Meridian
    to points on the ground on your
    local continental plate
    such as the GNSS ground stations.
</p>
<p>
    Within that reference frame
    your continental plate and everything on it
    stays still and all the other plates
    move.
    Your latitude, longitude
    and height stay the same.
</p>
<p>
    The European Terrestrial Reference System
    and the associated European Terrestrial
    Reference Frame
    provide a coordinate system
    which is fixed to points on the ground in Europe.
    There are similar reference frames for other
    regions.
</p>
<p>
    This convention works locally
    but after a few years your notion of the Poles
    and the Equator
    drift away from measurable reality.
    Those poles no longer match the Earth's
    axis of spin.
<p>
    To stop the various reference
    frames getting too far out of kilter
    with each other and with reality,
    they are reset every few years
    to pull them back to the
    International Terrestrial Reference Frame.
</p>
<p>

    When you record a position using a GNSS receiver,
    you should also record which
    reference frame you used and
    which version of it.
</p>
<p>
    The same point applies to the GNSS satellites.
    The GNSS system depends on published predictions
    of their positions in space within some Earth-based
    reference frame.
    To make sense of the positions,
    you have to know which reference frame is being used
    and,
    if necessary,
    convert the positions to the frame that you are using.
</p>

<h3>Universal Transverse Mercator (UTM) Coordinates</h3>
<p>
    In the early twentieth century,
    The UK Ordnance Survey
    used longitude and latitude to define positions
    as seen on this
    <a href="https://maps.nls.uk/view/101437072">
        1938 map of Guildford
    </a>.
    If you zoom into the top of the map
    you'll see that it shows longitude
    along the top and bottom
    and latitude along each side.
</p>
<p>
    In the 1940s
    various national mapping authorities adopted
    UTM coordinates instead of latitude and longitude.
    This approach divides the Ellipsoid into 60 zones,
    each covering about six degrees of longitude.
    The local surface of each zone is projected onto a flat map
    and each position is represented by
    its distance along an east-west line
    (its <b><i>easting</i></b>)
    from a zero point
    and its distance along a north-south line
    (its <b><i>northing</i></b>)
    from the same point.
    More details on UTM are
    <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">
        here</a>.

</p>
<p>
    A position in three dimensions can be represented
    by its easting, its northing and its height above
    some base such as mean sea level.
    However,
    making a flat map representing objects
    on a curved surface involves compromises,
    even in a small country like the UK.
</p>
<p>
    During its last complete retriangulation of the UK
    (1925 to 1962),
    The Ordnance Survey
    adopted a system based on
    UTM
    and created
    the Ordnance Survey National Grid reference system (OSGB),
    also known as British National Grid (BNG).
    More about that
    <a href="https://en.wikipedia.org/wiki/Ordnance_Survey_National_Grid">
        here
    </a>.
</p>
<p>
    The zero point for OSGB
    eastings and northings is out at sea
    to the south-west of Land's End.
    The notional
    Mean Sea Level was fixed in the 1920's
    using the facility at Newlyn.
</p>

<p>
    OSGB is defined in
    terms of reference points on the ground -
    in the mid twentieth century,
    a network of physical markers
    called Trig Points.
    The most recognisable of these are
    four-foot high concrete pillars
    at strategic points around the country,
    usually on high ground so that they can be seen from a distance.
    These trig points move with continental drift
    so the OSGB grid moves with them.
</p>
<p>
    OS maps printed since that retriangulation
    have shown eastings and northings
    around the edges.
</p>





<h3>Earth-Centred Earth-Fixed (ECEF or "Cartesian") Coordinates</h3>
<p>
    The data used by a GNSS device
    comes from satellites following an
    elliptical orbit,
    one of the foci of which is the
    centre of mass of the Earth.
    It's fairly natural to specify a position
    relative to that point.
    ECEF format uses cartesian (x, y, z) coordinates
    measured in metres from that centre.
</p>
<p>
    ECEF coordinates are "Earth-fixed" because the coordinate system is fixed
    to lines of longitude and latitude.
    The X axis runs from the North Pole to the South Pole,
    the Y axis runs through the two points
    where zero latitude
    meets the Equator.
    The Z axis is perpendicular to the other two.
    For more details of ECEF see
    <a href="https://www.mathworks.com/help/map/choose-a-3-d-coordinate-system.html">
        here
    </a>.
</p>
<p>
    As we've seen,
    the position of the poles and the equator
    depend on which terrestrial reference frame you are using,
    so the same goes for ECEF coordinates.
    To understand a position in ECEF form,
    you need to know which TRF the cartesian axes sit within.

</p>
<p>
    A position expressed in ECEF format can be converted to
    longitude, latitude and height above some surface,
    such as the Geoid, fairly easily.
</p>
<p>
    Conversion to UTM is more difficult,
    which is a nuisance here in the UK
    because
    we have records of positions
    using
    Ordnance Survey grid references
    going back 60 years.
    The OS offers a
    <a href="https://www.ordnancesurvey.co.uk/gps/transformation/">
        web page
    </a>
    that converts a position
    between a grid reference
    and all of the other formats
    but it
    introduces a significant error,
    anything up to a metre.
</p>
<p>
    So I have GNSS equipment
    that can find my position within a couple of centimetres,
    but if I use the website to
    convert it to an OS grid reference,
    I lose a lot of that accuracy.
</p>
<p>
    One of my GNSS devices is a Garmin Etrax,
    a hiking aid.
    It shows me my position on a map
    and as its
    OS easting, northing and height above sea level,
    but that could be misleading.
    Internally it's using ECEF format,
    because that's how GNSS works.
    It's then converting the result for display,
    maybe or maybe not using a similar method
    to the OS web page and
    introducing the same kind of error.
</p>
<h3>What Three Words</h3>
<p>

    A GNSS receiver such as the one in a smartphone
    will typically find its position accurate
    to about three metres.
    Doing any better requires
    the help of a correction service.
    The <a href='https://what3words.com/'>What Three Words</a>
    system divides the world into 3-metre squares
    and gives each a code using three words.
    For example "pretty.needed.chill"
    represents a point by the river Cherwell
    near Oxford in the UK.
</p>
<p>
    This is a very convenient way to record positions -
    the Surrey
    <a
        href='https://www.surreycc.gov.uk/land-planning-and-development/heritage-and-planning/portable-antiquities-scheme'>
        Portable Antiquities Scheme
    </a>
    recommends it use for reporting finds.
</p>
<p>
    Recording a position at that accuracy
    is better than nothing, but bear in mind
    that the real position is somewhere within
    three metres <i>in all directions</i>,
    so within a six-metre wide circle.
    If an archaeologist wants to come back and search
    that area later,
    they may have to dig a very big hole to find the right spot.
    They have to dig holes to find things
    but they are painfully aware
    that they are destroying other archaeology
    that could be found in the future,
    so they want the hole to be as small as possible.
</p>

<h2>Accurate GNSS</h2>
<p>
    A GNSS device on the ground receives signals from the satellites and
    uses a bit of mathematics similar to trigonometry to find
    its
    position.
    It needs signals from 4 satellites to do that.
    A multi-constellation receiver can
    use
    signals from
    satellites in any or all of the constellations and
    in good conditions upwards of twenty satellites
    will be visible to it at any time.
    That doesn't make it more accurate
    but it reduces the the time to get a fix.
</p>
<p>
    In 1997 Geoffrey Blewitt published his paper

    <a href='https://nbmg.unr.edu/staff/Blewitt Basics of gps.pdf'>
        Basics of the GPS Technique Observation Equations
    </a>
    ".
    At the time he was a researcher at Newcastle University.
    He's now Professor at the Nevada Bureau of Mines and Geology.
</p>

<p>
    Blewitt's paper describes some fairly advanced
    mathematical techniques
    that can be used to produce an accurate GNSS system.
    Fortunately,
    that mathematics is taken care of by the equipment
    and you don't need to understand it in detail,
    but some knowledge of what's going on helps,
    especially when things go wrong.
</p>
<p>
    <a href='https://www.youtube.com/watch?v=Oc1LBFDj2MA'>This YouTube video</a>
    explains the concepts behind GNSS in very simple terms. The notes also
    explain how to build your own GNSS receiver.
</p>
<p>
    Blewitt's paper is over twenty years old and things have changed.
    There are now more satellites,
    GPS and others,
    so you can see more of them pretty much anywhere on the
    surface of the Earth if you have a clear view of the sky.
</p>
<p>
    Also, and very important,
    the Selective Accuracy (SA) feature,
    whereby
    the GPS signal was partly encrypted
    to restrict its accuracy for most users,
    was turned off in the year 2000.
    Part of the paper describes a technique
    called Point Positioning (PP) that could be used
    to defeat Selective Acccuracy
    and find a position within about three metres.
</p>
<p>

    PP is no longer useful
    but a similar technique called
    Precise Point Positioning (PPP)
    is still used to post-process
    the positions taken in a survey
    and correct them to two centimetre accuracy.
    A number of organisations offer a free PPP
    service including
    <a href='https://webapp.csrs-scrs.nrcan-rncan.gc.ca/geod/tools-outils/ppp.php'>this one</a>
    from
    the Canadian government's Natural Resources Canada.
    It works to the ITRF20 reference frame.
</p>
<p>
    Each satellite carries an atomic clock,
    so it knows the time very accurately.
    It broadcasts
    an <b><i>ephemeris</i></b>,
    a table that gives its expected position
    in the near future,
    within the International Terrestrial
    Reference Frame.
    Every second it broadcasts a signal giving the time.
</p>
<p>
    A GNSS receiver with an equally accurate clock
    could use the time signals from three satellites
    to find its position
    within the ITRF.
    The transit times of the signals
    and the speed of light in a vacuum
    give the distance to each satellite
    and the ephemerides give their positions.
    A bit of trigonometry gives the receiver its own position.
    In mathematical terms,
    this involves a polynomial equation with three unknowns.
    Finding the unknowns requires three sets of input,
    so signals from three satellites.
</p>
<p>
    The calculated distance to the satellite
    is called the <b><i>pseudorange</i></b>,
    pseudo because it's never quite right.
    The signal is distorted,
    particularly by the ionosphere,
    and often
    arrives at the receiver having been reflected off
    a wall or the side of a hill.
    It doesn't travel in a straight line
    so it takes longer than expected to arrive.
    Also,
    signals at different frequencies
    may take different paths through these obstacles,
    so two signals sent at the same time from the same satellite
    may arrive at slightly different times,
    producing two different pseudoranges.
</p>
<p>
    Atomic clocks are expensive, delicate and heavy.
    The SatNav in your phone doesn't have one,
    so it doesn't know the time accurately.
    Instead it takes the ephemerides and the time signals from four satellites
    and finds its position <b><i>and</i></b>
    the time
    (using a polynomial with four unknowns,
    which requires four sets of inputs).
    So your phone gets its position
    and the time of day from the GNSS satellites.
</p>
<p>
    The intensity of the signals is very low
    and fairly light cloud can cause serious
    reception problems.
    To get an accurate fix,
    the receiver scans the signals for several seconds,
    sometimes several minutes if
    reception is poor.
    On its own, the device can figure out its position to within a few metres.
</p>
<p>
    This accuracy is acceptable for vehicle
    navigation
    but other purposes such as land surveying require greater accuracy.
</p>
<p>
    As well as errors in the psuedorange values,
    the satellites are never quite in the positions that their
    ephemerides say they should be.
    The operators monitor the real positions
    and publish them,
    but those data are only available about ten days
    later.
</p>

<h3>Precise Point Positioning</h3>
<p>
    Section 4 of Blewitt's paper
    describes methods to compensate for errors
    in the satellite position and the calculated pseudorange.
    Once the real satellite positions are published,
    Precise Point Positioning (PPP)
    can be used to
    post-process a set of observations and correct them.
    Various organisations offer a free PPP service.
</p>
<p>
    You can use a GNSS device to run a survey,
    taking many positions accurate to a few metres
    and then a few days later
    use a PPP service to correct the
    results to a couple of centimetres.
</p>

<h3>Relative Positioning</h3>
<p>
    Section 6 of Blewitt's paper shows how two GNSS devices
    can be used to get an accurate position
    immediately.
    One device,
    the <b><i>base station</i></b> is fixed in a known position
    and has a dual-band receiver -
    it can receive signals on two wavebands.
    The other device, the <b><i>rover</i></b> can be moving
    and it can have a cheaper single-band receiver.
    (The price difference used to be significant,
    but these days,
    not so much.
    Dual-band rovers are now quite common).
</p>

<p>
    The base station
    broadcasts its position and
    information about the signals it's receiving.
    The rover uses those data
    and the signals that it's receiving from the satellites
    to make a very good estimate
    of its own position <b><i>relative to the base station</i></b>.
    In ideal conditions,
    if the two devices are within about 10 km of each other,
    the estimate is accurate to about two centimetres,
    plus (crucially) any error in the base station's broadcast
    position.
    One base station can support many rovers
</p>

<p>
    According to one equipment manufacturer,
    beyond 10 Km the accuracy drops off linearly -
    at 20 Km apart, it's about 4cm,
    at 40 Km apart, it's about 8 cm and so on.
    Beyond about 240 Km,
    the result is no better than that
    which the rover could achieve unaided.
</p>

<p>
    Unfortunately, I don't live in ideal conditions.
    I live in Surrey in the UK.
    My background is in IT and when I read ads
    that talk about performance "up to" some value,
    I ask "what's it down to?",
    "when do I get the maximum performance?" and
    "what's the typical performance?".
    I've run various tests
    and I report the results in these pages.
</p>

<p>
    The rover calculates its position
    relative to the position of the base,
    then adds that offset to the base's
    published position to find its own.
    So,
    the problem is moved to finding
    the position of the base accurately.
    If
    that's
    wrong by, say, 1.5m to the north,
    then each each rover using that base station will calculate positions that are
    wrong by the same amount.
    The positions in the resulting survey will be accurate relative to each other but they
    will each be shifted from their true position by 1.5m to the north.
</p>

<p>
    Since any position assumes some
    Terrestrial
    Reference Frame (TRF),
    and the rover works out its position
    relative to the position given by the base station,
    it also inherits whichever
    TRF
    the base is using.
</p>
<p>
    On the other hand,
    your rover doesn't inherit its geoid model
    from the base station.
    In fact the base station doesn't need a geoid model
    because that's only used to work out your
    orthometric height and
    the base doesn't need to do that.
    It just has a fixed position configured into it
    and publishes a data stream containing that
    and its satellite signal observations.
</p>

<p>
    The Relative Position technique described in Blewitt's paper
    is the basis of RealTime Kinematics (RTK)
    which allows a rover which is constantly moving
    (for example,
    the position sensor of
    a drone flight controller)
    to follow a predefined course very precisely.
</p>
<p>
    If you watched the celebrations for the
    Queen of England's Jubilee
    or the King's coronation,
    you will have seen nighttime
    displays using patterns
    made up of moving spots of light.
    These are created using a large set of specialist
    drones,
    essentially flying light bulbs.
    Each drone uses RTK
    to follow its prescribed path
    and stay in the right position.
</p>


<p>
    The base station can send out its observations using Long Range Radio (LoRa)
    or over the Internet using NTRIP
    (Networked Transmission of RTCM using Internet Protocols).
    A rover used for surveying typically uses the
    surveyor's mobile phone to act as an Internet modem.
</p>

<p>
    Accurate GNSS systems are more accurate,
    faster and
    easier to use than theodolites.
    The UK's mapping authority the
    Ordnance
    Survey has been using satellite positioning for many years.
    In the early days the equipment was expensive but
    now a
    base and rover set can cost less than $1,000.
</p>

<p>
    linksList(`1.coordinates.html', `index.html', `2.position.html')
</p>





include(sourceRoot/trailer.m4.html)